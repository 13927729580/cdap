apply plugin: 'idea'
apply plugin: 'maven'

defaultTasks 'build'

void setDefault (String name, Object value)
{
    if(!project.hasProperty (name))
    {
        project.ext.set(name, value);
    }
}

if (version == 'unspecified')
{
    version = '0.1.0-SNAPSHOT'
}
setDefault('groupId', 'com.continuuity')
setDefault('artifactId', projectDir.name)
setDefault('artifactoryUsername', 'gradle');
setDefault('artifactoryPassword', '{DESede}Rk/0rTcxzWomG91yhihmswrLqVnA6oIy');

/// Define artifact repositories.
repositories {
    maven {
        credentials {
            username artifactoryUsername
            password artifactoryPassword
        }
        url "https://repository.continuuity.com/continuuity-gradle-local/"
    }
    maven {
        credentials {
            username artifactoryUsername
            password artifactoryPassword
        }
        url "https://repository.continuuity.com/libs-snapshot"
    }
    maven {
        credentials {
            username artifactoryUsername
            password artifactoryPassword
        }
        url "https://repository.continuuity.com/libs-release"
    }
}

configurations.all {
    resolutionStrategy.cacheChangingModulesFor 0, 'minutes'
}

uploadArchives {
    repositories {
        repositories.mavenDeployer {
            repository(url: "https://repository.continuuity.com/continuuity-gradle-local") {
                authentication(userName: artifactoryUsername, password: artifactoryPassword)
            }
            pom.version = version
            pom.artifactId = artifactId
            pom.groupId = groupId
        }
    }
}