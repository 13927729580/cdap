apply plugin: 'continuuity'

buildscript {
  apply from: 'continuuity.gradle'
}

/**
 * Specify all the dependencies
 */
dependencies {

    /// Internal dependencies.
    if(multiModule && ! buildingRelease)
    {
        compile project(":flow")
        compile project(":data-fabric")
        compile project(":gateway")
    }
    else
    {
        compile group: 'com.continuuity', name: 'data-fabric', version: '0.1.0-SNAPSHOT'
        compile group: 'com.continuuity', name: 'flow', version: '0.1.0-SNAPSHOT'
        compile group: 'com.continuuity', name: 'gateway', version: '0.1.0-SNAPSHOT'
        compile group: 'com.continuuity', name: 'data-fabric', classifier: 'api', version: '0.1.0-SNAPSHOT'
        compile group: 'com.continuuity', name: 'flow', classifier: 'api', version: '0.1.0-SNAPSHOT'
    }
}

/**
 * Exclude any config xml from singlenode jar
 */
jar.exclude '*.xml'

// ideally we would use a name of "continuuity" and classifier of "test"
// unfortunately there is a known gradle bug that will prevent uploading of
// the pom if the artifact has a classifier. Tried many ways to work around
// that and finally gave up. Hence we use "continuuity-test" as the artifact
// name. The gradle bugs is discussed here with links to the Jiras:
// http://forums.gradle.org/gradle/topics/pom_doesnt_upload

task testJar(type: Jar) {
    baseName = "continuuity-test"
    from sourceSets.test.output
}

artifacts {
    archives testJar
}

// add a filter to the upload task that only passes the test jar. Otherwise
// we would be uploading test.jar, test-sources.jar, test-javadoc.jar and
// test.pom, when all we have is really the test jar

uploadArchives {
    repositories.mavenDeployer {
        addFilter('test') {artifact, file ->
            artifact.name == 'continuuity-test'
        }
    }
}
