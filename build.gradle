apply plugin: 'java'
apply plugin: 'application'

/**
 * Building of API jar
 */
smartyFacts {
    api {
        enableJavadoc()
        enableSourceJar()
    }
}

/**
 * Specify all the dependencies
 */
dependencies {

    compile elastic([group: 'com.continuuity', name: 'common', version: "${version}", changing: true], "common")
    compile elastic([group: 'com.continuuity', name: 'common', classifier: 'api', version: "${version}", changing: true], "common")
    compile elastic([group: 'com.continuuity', name: 'overlord', version: "${version}", changing: true], "overlord")
    compile elastic([group: 'com.continuuity', name: 'overlord', classifier: 'thrift', version: "${version}", changing: true], "overlord")
    compile elastic([group: 'com.continuuity', name: 'data-fabric', version: "${version}", changing: true], "data-fabric")
    compile elastic([group: 'com.continuuity', name: 'data-fabric', classifier: 'api', version: "${version}", changing: true], "data-fabric")
    apiCompile elastic([group: 'com.continuuity', name: 'data-fabric', classifier: 'api', version: "${version}", changing: true], "data-fabric")
    apiCompile elastic([group: 'com.continuuity', name: 'common', classifier: 'api', version: "${version}", changing: true], "common")

    // Clover dependency
    clover elastic([group: 'com.continuuity', name: 'data-fabric', classifier: 'api', version: "${version}", changing: true], "data-fabric")
    clover elastic([group: 'com.continuuity', name: 'overlord', classifier: 'thrift', version: "${version}", changing: true], "overlord")

    /// External dependencies.
    compile libraries.thrift
    compile libraries.akka_actor
    compile libraries.kryo
    compile libraries.google_gson
    compile libraries.google_guice
    compile libraries.google_guava
    compile libraries.mysql
    compile libraries.hsql
    compile libraries.http_client
    compile libraries.avro
    compile libraries.avro_ipc
    compile libraries.flume_ng_sdk
    compile libraries.flume_ng_core
    compile libraries.apache_commons_cli
    compile libraries.apache_commons_logging
    compile libraries.apache_commons_math
    compile libraries.apache_commons_io

    // We need to remove dependency on these.
    compile group: 'org.apache.velocity', name: 'velocity', version: '1.7'
    compile group: 'com.yammer.metrics', name: 'metrics-core', version: '2.1.5'
    compile group: 'junit', name: 'junit', version: '4.10'
}

// Includes API output to main and test source sets.
sourceSets {
    main {
        compileClasspath += api.output
        runtimeClasspath += api.output
    }
    test {
        compileClasspath += api.output
        runtimeClasspath += api.output
    }
}

javadoc {
    classpath += sourceSets.api.output
}

clover {
    excludes << '**/manager/stubs/*'
}

sonar {
    project {
        sourceExclusions = '**/manager/stubs/*'
    }
}

jar.exclude '*.xml'
